<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>VFIED â€“ Zero-Friction Demo</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    :root{--bg1:#667eea;--bg2:#764ba2;--glass:rgba(255,255,255,.14);--glass2:rgba(255,255,255,.22)}
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,system-ui,Arial,sans-serif;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      color:#fff; min-height:100svh;
    }
    .wrap{max-width:430px;margin:auto;min-height:100svh;padding:20px 12px 96px;position:relative}
    .live{position:fixed;top:12px;right:12px;background:#22c55e;color:#fff;border-radius:20px;
      padding:.45rem .8rem;font-weight:700;font-size:.78rem;display:flex;gap:.5rem;align-items:center}
    .dot{width:8px;height:8px;background:#fff;border-radius:999px;animation:pulse 2s infinite}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.45}}
    .bar{display:flex;gap:.5rem;flex-wrap:wrap;margin:64px 0 16px;justify-content:center}
    .chip{background:var(--glass);border:1px solid var(--glass2);backdrop-filter:blur(12px);
      padding:.5rem .9rem;border-radius:999px;font-size:.85rem}
    .card{
      background:var(--glass);border:1px solid var(--glass2);backdrop-filter:blur(16px);
      border-radius:22px;padding:22px;text-align:center;transition:transform .2s, box-shadow .2s
    }
    .card:hover{transform:translateY(-2px);box-shadow:0 18px 40px rgba(0,0,0,.22)}
    .food{font-size:3rem;margin-bottom:.5rem}
    .title{font-size:1.45rem;font-weight:800;margin-bottom:.25rem}
    .tag{opacity:.9;font-size:.95rem;margin-bottom:12px}
    .row{display:flex;gap:.6rem;flex-wrap:wrap;justify-content:center;margin:10px 0 0}
    .pill{font-size:.8rem;background:rgba(0,0,0,.22);padding:.35rem .6rem;border-radius:999px;border:1px solid rgba(255,255,255,.18)}
    .rest{
      margin-top:12px;text-align:left;background:rgba(255,255,255,.1);
      border:1px solid rgba(255,255,255,.18);border-radius:14px;padding:14px
    }
    .rest .hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
    .open{background:#22c55e;color:#fff;padding:.2rem .55rem;border-radius:10px;font-size:.72rem;font-weight:700}
    .details{display:flex;gap:.85rem;opacity:.95;font-size:.86rem;flex-wrap:wrap}
    .actions{display:flex;gap:.6rem;margin-top:12px}
    .btn{border:0;border-radius:12px;padding:.8rem 1rem;font-weight:800;cursor:pointer;flex:1}
    .primary{background:#22c55e;color:#fff}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,.35);color:#fff}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:.6rem;margin:12px 0}
    .gbtn{border:1px solid rgba(255,255,255,.28);background:rgba(255,255,255,.1);color:#fff;border-radius:12px;padding:.6rem;font-weight:700;cursor:pointer}
    .section{margin-top:18px}
    .subtle{opacity:.82;font-size:.88rem}
    .footer{
      position:fixed;left:50%;transform:translateX(-50%);
      bottom:18px;background:rgba(0,0,0,.6);backdrop-filter:blur(18px);
      border:1px solid rgba(255,255,255,.15);border-radius:26px;padding:.55rem;
      display:flex;gap:.3rem
    }
    .tab{border:0;background:transparent;color:rgba(255,255,255,.7);font-weight:800;padding:.65rem 1rem;border-radius:18px;cursor:pointer}
    .tab.active{background:rgba(255,255,255,.22);color:#fff}
    .row-slim{display:flex;gap:.5rem;align-items:center;justify-content:center;margin:10px 0 14px;flex-wrap:wrap}
    select, .chipBtn{
      appearance:none;border:1px solid rgba(255,255,255,.28);background:rgba(255,255,255,.12);
      color:#fff;border-radius:12px;padding:.55rem .8rem;font-weight:700
    }
    .chipBtn{cursor:pointer}
    .chipBtn.active{outline:2px solid #22c55e;background:rgba(34,197,94,.2)}
    .muted{opacity:.65}
    .hidden{display:none !important}
    .small{font-size:.82rem}
    .hr{height:1px;background:rgba(255,255,255,.18);margin:10px 0}
  </style>
</head>
<body>
  <div class="live"><span class="dot"></span>LIVE</div>

  <div class="wrap">
    <!-- context bar -->
    <div id="contextBar" class="bar">
      <div class="chip">ğŸ“ Detectingâ€¦</div>
      <div class="chip">ğŸŒ¤ï¸ Weather</div>
      <div class="chip">â° Time</div>
    </div>

    <!-- controls -->
    <div class="row-slim">
      <select id="country" title="Country">
        <option value="GB" selected>ğŸ‡¬ğŸ‡§ United Kingdom</option>
        <option value="KE">ğŸ‡°ğŸ‡ª Kenya</option>
        <option value="US">ğŸ‡ºğŸ‡¸ United States</option>
        <option value="JP">ğŸ‡¯ğŸ‡µ Japan</option>
        <option value="FR">ğŸ‡«ğŸ‡· France</option>
        <option value="IN">ğŸ‡®ğŸ‡³ India</option>
      </select>
      <select id="city" title="City">
        <option value="London" selected>London</option>
        <option value="Nairobi">Nairobi</option>
        <option value="New York">New York</option>
        <option value="Tokyo">Tokyo</option>
        <option value="Paris">Paris</option>
        <option value="Mumbai">Mumbai</option>
      </select>
      <select id="budget" title="Budget">
        <option value="low">Â£</option>
        <option value="medium" selected>Â£Â£</option>
        <option value="high">Â£Â£Â£</option>
      </select>
    </div>

    <div class="row-slim small">
      <button class="chipBtn" data-diet="vegetarian">ğŸŒ± Vegetarian</button>
      <button class="chipBtn" data-diet="vegan">ğŸ¥¬ Vegan</button>
      <button class="chipBtn" data-diet="gluten-free">ğŸŒ¾ GF</button>
      <button class="chipBtn" data-diet="halal">â˜ªï¸ Halal</button>
      <button class="chipBtn" data-diet="pescatarian">ğŸŸ Pesc</button>
    </div>

    <div class="row-slim small">
      <label><input id="useLive" type="checkbox" checked /> Use Live API</label>
      <span class="muted">/v1/recommend</span>
    </div>

    <!-- suggestion card -->
    <div class="card" id="card">
      <div class="food" id="foodEmoji">ğŸœ</div>
      <div class="title" id="foodName">Hot Ramen</div>
      <div class="tag" id="tagline">Perfect for rainy London weather</div>

      <div id="aiNotes" class="section hidden">
        <div class="subtle" id="friendMsg"></div>
        <div class="subtle" id="dietNote"></div>
        <div class="subtle" id="weatherNote"></div>
        <div class="hr"></div>
      </div>

      <div class="rest" id="restBlock">
        <div class="hdr">
          <div style="font-weight:800" id="restName">Local spot</div>
          <div class="open" id="restOpen">Open</div>
        </div>
        <div class="details" id="restDetails">
          <span>â­ 4.6</span><span>ğŸ’· Â£Â£</span><span>ğŸš¶ 3 min</span><span>â±ï¸ Short wait</span>
        </div>
        <div class="actions">
          <button class="btn primary" id="orderBtn">Order</button>
          <button class="btn ghost" id="directionsBtn">Directions</button>
        </div>
      </div>
    </div>

    <!-- quick actions -->
    <div class="grid">
      <button class="gbtn" id="refreshBtn">ğŸ¯ Refresh</button>
      <button class="gbtn" id="browseBtn">ğŸ” Browse</button>
      <button class="gbtn" id="friendsBtn">ğŸ‘¥ Ask Friends</button>
    </div>

    <div class="section subtle small" id="status">Ready.</div>
  </div>

  <!-- footer nav -->
  <div class="footer">
    <button class="tab active">Instant</button>
    <button class="tab">Browse</button>
    <button class="tab">Social</button>
    <button class="tab" id="settingsTab">Settings</button>
  </div>

  <script>
    // ----------- helpers -----------
    const $ = (id) => document.getElementById(id);
    const sleep = (ms) => new Promise(r => setTimeout(r, ms));

    const simulated = [
      {emoji:'ğŸœ', name:'Hot Ramen', tagline:'Perfect for rainy London weather', rest:'Koya Soho'},
      {emoji:'ğŸ•', name:'Neapolitan Pizza', tagline:'Fresh from the oven nearby', rest:'Franco Manca'},
      {emoji:'ğŸ¥—', name:'Buddha Bowl', tagline:'Light, healthy & satisfying', rest:'Farmstand'},
      {emoji:'ğŸŒ®', name:'Fish Tacos', tagline:'Zingy & light for a quick bite', rest:'Baja Shack'},
    ];

    function getLocationPayload(){
      const country_code = $('country').value;
      const city = $('city').value;
      const countryNames = {GB:'United Kingdom', KE:'Kenya', US:'United States', JP:'Japan', FR:'France', IN:'India'};
      return { city, country: countryNames[country_code] || 'â€”', country_code };
    }

    function getDietary(){
      return Array.from(document.querySelectorAll('.chipBtn.active')).map(btn => btn.dataset.diet);
    }

    async function recommendViaAPI(){
      const payload = {
        location: getLocationPayload(),
        mood_text: 'stressed but want something light',
        dietary: getDietary(),
        budget: $('budget').value,
        menu_source: 'global_database'
      };

      const t0 = performance.now();
      const res = await fetch('http://localhost:3001/v1/recommend', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      if(!res.ok) throw new Error('API ' + res.status);
      const json = await res.json();
      const t1 = performance.now();

      return { json, ms: Math.round(t1 - t0) };
    }

    function renderFromAPI(data){
      const { food, friendMessage, dietaryNote, weatherNote, availabilityNote, context } = data.json;
      $('foodEmoji').textContent = food?.emoji || 'ğŸ½ï¸';
      $('foodName').textContent  = food?.name  || 'Great Choice';
      $('tagline').textContent   = availabilityNote || 'A solid pick for right now';

      // AI notes
      $('aiNotes').classList.remove('hidden');
      $('friendMsg').textContent  = friendMessage ? 'ğŸ’¬ ' + friendMessage : '';
      $('dietNote').textContent   = dietaryNote   ? 'ğŸŒ± ' + dietaryNote   : '';
      $('weatherNote').textContent= weatherNote   ? 'ğŸŒ¤ï¸ ' + weatherNote   : '';

      // Simple restaurant block (we donâ€™t have live places yet)
      $('restName').textContent = context?.location?.city ? `Top pick in ${context.location.city}` : 'Nearby spot';
      $('restDetails').innerHTML = `
        <span>ğŸŒ ${food?.country_code || context?.location?.country_code || ''}</span>
        <span>ğŸ·ï¸ ${food?.category || 'comfort'}</span>
        <span>âš¡ ${data.ms}ms</span>
      `;
      $('status').textContent = `âœ… Live API Â· ${data.ms}ms`;
    }

    function renderFromSim(seed=0){
      const s = simulated[seed % simulated.length];
      $('foodEmoji').textContent = s.emoji;
      $('foodName').textContent  = s.name;
      $('tagline').textContent   = s.tagline;
      $('restName').textContent  = s.rest;
      $('restDetails').innerHTML = `<span>â­ 4.6</span><span>ğŸ’· Â£Â£</span><span>ğŸš¶ 3 min</span>`;
      $('aiNotes').classList.add('hidden');
      $('status').textContent = 'â„¹ï¸ Simulated suggestion';
    }

    async function refreshSuggestion(){
      $('status').textContent = $('useLive').checked ? 'â³ asking AIâ€¦' : 'â³ refreshingâ€¦';
      $('card').style.opacity = .6;

      await sleep(200);

      if($('useLive').checked){
        try{
          const data = await recommendViaAPI();
          renderFromAPI(data);
        }catch(e){
          renderFromSim(Math.floor(Math.random()*1000));
          $('status').textContent = 'âš ï¸ API unavailable Â· showing demo';
        }
      }else{
        renderFromSim(Math.floor(Math.random()*1000));
      }

      $('card').style.opacity = 1;
      updateContextBar();
    }

    function updateContextBar(){
      const loc = getLocationPayload();
      const time = new Date();
      const hour = time.getHours();
      const meal = hour<11?'Breakfast':hour<15?'Lunch':'Dinner';
      const chips = [
        `ğŸ“ ${loc.city}`,
        `ğŸ—ºï¸ ${loc.country_code}`,
        `â° ${meal} time`,
        getDietary().length? `ğŸŒ± ${getDietary().join(', ')}` : 'ğŸ½ï¸ No filters'
      ];
      $('contextBar').innerHTML = chips.map(c=>`<div class="chip">${c}</div>`).join('');
    }

    // ----------- events -----------
    window.addEventListener('DOMContentLoaded', () => {
      // dietary chip toggles
      document.querySelectorAll('.chipBtn').forEach(btn=>{
        btn.addEventListener('click', ()=> {
          btn.classList.toggle('active');
          updateContextBar();
        });
      });
      // selects
      ['country','city','budget'].forEach(id => {
        $(id).addEventListener('change', updateContextBar);
      });

      $('refreshBtn').addEventListener('click', refreshSuggestion);
      $('browseBtn').addEventListener('click', ()=> alert('ğŸ” Browse prototype coming soon'));
      $('friendsBtn').addEventListener('click', ()=> alert('ğŸ‘¥ Social share coming soon'));
      $('orderBtn').addEventListener('click', ()=> alert('ğŸ½ï¸ Would deep-link to Deliveroo/UberEats'));
      $('directionsBtn').addEventListener('click', ()=> alert('ğŸ—ºï¸ Would open Maps with directions'));

      updateContextBar();
      refreshSuggestion(); // initial
    });
  </script>
  <link rel="stylesheet" href="./src/style.css">
  <script type="module" src="./src/main.js"></script
</body>
</html>
